on:
  issues:
    types: [labeled]

jobs:
  automate_invite:
    runs-on: ubuntu-latest
    steps:
      - name: Invite on label
        uses: vj-abigo/invite-on-label@v1.4
        with:
          organization: JDStudio
          label: 'invite me to the organization'
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          comment: |
            It's great having you contribute to this project. If you would like to continue contributing to open source and want to be part of an awesome and inclusive community, consider joining our GitHub Organisation and Discord Server. We help and encourage each other to contribute to open source little and often ðŸ¤“. Any questions, feel free to ask!

            <b>Invitation sent to join the GitHub Organisation. Welcome to the community ðŸŽ‰</b><br><br>
            Don't forget after accepting to make it public so it appears on your GitHub profile for everyone else to see.
            You can do this by finding your name in the GitHub organisation list and changing the dropdown to public
            https://github.com/orgs/jaidevstudio/people<br><br>
            Tips for practising:<br>It's about collaboration, communication, and adding value<br>I hope that helps
        env:
          INVITE_TOKEN: ${{ secrets.INVITE_TOKEN }}

      - name: Post message and close the issue
        run: |
          # Get the issue number
          ISSUE_NUMBER=$(echo "${{ github.event.issue.number }}")

          # Post a message on the issue
          curl -X POST -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            -d '{"body": "The invitation has been sent to join the GitHub Organization. The issue will now be closed. Feel free to reach out with any questions!"}' \
            "https://api.github.com/repos/${{ github.repository }}/issues/$ISSUE_NUMBER/comments"
          
          # Close the issue
          curl -X PATCH -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            -d '{"state": "closed"}' \
            "https://api.github.com/repos/${{ github.repository }}/issues/$ISSUE_NUMBER"
