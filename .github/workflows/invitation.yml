on:
  issues:
    types: [labeled]

jobs:
  automate_invite:
    runs-on: ubuntu-latest
    steps:
      - name: Invite on label
        uses: vj-abigo/invite-on-label@v1.4
        with:
          organization: JDStudio
          label: 'invite me to the organization'
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          comment: |
            It's awesome to have you contribute to this project! If you're passionate about open source and want to join a welcoming and inclusive community, consider becoming part of our GitHub Organization and Discord Server. We actively help and motivate each other to contribute more often ðŸ¤“. If you have any questions, feel free to ask!

            Invitation sent to join the GitHub Organization. Welcome to the community ðŸŽ‰

            Don't forget to set your membership to public once you've accepted the invitation so itâ€™s visible on your GitHub profile. You can do this by going to your GitHub organization and changing your membership status to public.

            Tips for practising:
            Collaboration, communication, and adding value are key
            Hope this helps!
        env:
          INVITE_TOKEN: ${{ secrets.INVITE_TOKEN }}

      - name: Post message and close the issue
        run: |
          # Get the issue number
          ISSUE_NUMBER=$(echo "${{ github.event.issue.number }}")

          # Post a comment on the issue
          curl -X POST -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            -d '{"body": "It\'s awesome to have you contribute to this project! If you\'re passionate about open source and want to join a welcoming and inclusive community, consider becoming part of our GitHub Organization and Discord Server. We actively help and motivate each other to contribute more often ðŸ¤“. If you have any questions, feel free to ask!\n\nInvitation sent to join the GitHub Organization. Welcome to the community ðŸŽ‰\n\nDon\'t forget to set your membership to public once you\'ve accepted the invitation so it\'s visible on your GitHub profile. You can do this by going to your GitHub organization and changing your membership status to public.\n\nTips for practising:\nCollaboration, communication, and adding value are key\nHope this helps!"}' \
            "https://api.github.com/repos/${{ github.repository }}/issues/$ISSUE_NUMBER/comments"
          
          # Close the issue
          curl -X PATCH -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            -d '{"state": "closed"}' \
            "https://api.github.com/repos/${{ github.repository }}/issues/$ISSUE_NUMBER"
